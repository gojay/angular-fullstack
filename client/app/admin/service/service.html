<div class="row">
    <div class="col-lg-12">
        <h3>{{vm.name}}</h3>
        <div class="text-center" ng-if="!vm.data.length">
        	<i class="fa fa-circle-o-notch fa-spin"></i>
        	Loading...
    	</div>
        <div ui-tree id="tree-root">
            <ol ui-tree-nodes ng-model="vm.data">
                <li ng-repeat="service in vm.data" ui-tree-node ng-include="'service-children.html'"></li>
            </ol>
        </div>
    </div>
</div>
<script type="text/ng-template" id="service-children.html">
    <div ui-tree-handle class="tree-node tree-node-content" data-nodrag>
        <div class="row">
            <div class="col-md-9">
                <a class="btn btn-success btn-xs" ng-if="service.children && service.children.length > 0" ng-click="vm.toggle(this)">
                    <i class="fa" ng-class="{
			          'fa-chevron-right': collapsed,
			          'fa-chevron-down': !collapsed
			        }"></i>
                </a>
                <label ng-if="!service.edited">
                    <div style="float:left;padding-right: 10px;">
                        <ionic-letter-avatar data="{{service.name}}" shape="round" fontsize="14" height="20" width="20"></ionic-letter-avatar>
                    </div>{{service.name}}
                    <small ng-if="service.price">( {{service.price | currency}} )</small>
                </label>
                <form name="form" class="form-inline" ng-submit="vm.saveItem(form, this)" ng-if="service.edited">
                    <div class="form-group">
                        <input type="text" class="form-control" name="name" ng-model="vm.model.name" placeholder="Name" required focus-if="vm.options.focused">
                    </div>
                    <div class="form-group" ng-class="{ 'has-error': form.price.$invalid }">
                        <input type="text" ui-money-mask="0" class="form-control" name="price" ng-model="vm.model.price" placeholder="Price">
                    </div>
                    <div class="form-group" ng-class="{ 'has-error': form.price.$invalid }">
                        <a class="btn btn-link" ng-click="vm.options.detail = !vm.options.detail">
							<i class="fa fa-angle-down" ng-if="!vm.options.detail"></i>
							<i class="fa fa-angle-up" ng-if="vm.options.detail"></i>
                        </a>
                    </div>
                    <div class="margin-top-bottom" ng-if="vm.options.detail">
	                    <div class="form-group">
	                       	<select class="form-control" ng-model="vm.model.mode" ng-options="mode.id as mode.title for mode in vm.options.modes"></select>
	                    </div>
	                    <div class="form-group" ng-if="vm.model.mode == 1">
	                       	<select class="form-control" ng-model="vm.model.reference" ng-options="refer._id as refer.name for refer in vm.references"></select>
	                    </div>
                    </div>
                    <div class="margin-top-bottom" ng-if="vm.options.detail">
	                    <div class="form-group" ng-class="{ 'has-error': form.url.$invalid }">
	               			<input type="url" class="form-control" name="url" ng-model="vm.model.picture" placeholder="Picture URL">
	                    </div>
                    </div>
                    <div class="margin-top-bottom" ng-if="vm.options.detail">
	                    <div class="form-group">
	                       <textarea class="form-control" ng-model="vm.model.description" cols="50" style="width:100%"></textarea>
	                    </div>
                    </div>
                    <button type="submit" class="btn btn-success">
                        <i class="fa fa-circle-o-notch fa-spin" ng-if="service.loading"></i> {{ service.loading ? 'Saving...' : 'Save' }}
                    </button>
                </form>
            </div>
            <div class="col-md-3">
                <a class="pull-right btn btn-danger btn-xs" data-nodrag ng-click="vm.removeItem(this)" ng-if="!service.isRoot">
                    <i class="fa fa-times" ng-if="!service.deleting"></i>
                    <span ng-if="service.deleting"><i class="fa fa-circle-o-notch fa-spin"></i> Deleting..</span>
                </a>
                <a class="pull-right btn btn-primary btn-xs" data-nodrag ng-disabled="vm.options.edited || service.mode == 1" ng-click="vm.addItem(this)" style="margin-right: 8px;">
                    <i class="fa fa-plus"></i>
                </a>
                <a class="pull-right btn btn-default btn-xs" data-nodrag ng-click="vm.editItem(this)" ng-disabled="vm.options.edited && !service.edited" ng-if="!service.isRoot || service.edited" style="margin-right: 8px;" title="Edit">
                    <i class="fa fa-edit" ng-if="!service.edited"></i>
                    <i class="fa fa-ban" ng-if="service.edited"></i>
                </a>
            </div>
        </div>
    </div>
    <ol ui-tree-nodes="" ng-model="service.children" ng-class="{hidden: collapsed}">
        <li ng-repeat="service in service.children" ui-tree-node ng-include="'service-children.html'">
        </li>
    </ol>
</script>
<footer></footer>
